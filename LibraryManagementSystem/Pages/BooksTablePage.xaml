<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="LibraryManagementSystem.Pages.BooksTablePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:LibraryManagementSystem.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:primitives="using:CommunityToolkit.WinUI.UI.Controls.Primitives"
    mc:Ignorable="d">

    <Grid>
        <StackPanel Orientation="Vertical">
            <CommandBar HorizontalAlignment="Left" DefaultLabelPosition="Collapsed">
                <AppBarButton Icon="Back" Click="BackButton_Click"/>
            </CommandBar>

            <TextBlock HorizontalAlignment="Center" Text="Library Management System" Margin="0 20 0 0" FontSize="25"/>

            <CommandBar  HorizontalAlignment="Right" DefaultLabelPosition="Right" Margin="40 5">
                <AppBarButton Icon="Add" Label="Add"/>
            </CommandBar>

            <controls:DataGrid x:Name="BooksTable"
                               ItemsSource="{x:Bind Books}"
                               AutoGenerateColumns="False"
                               HeadersVisibility="Column"
                               HorizontalAlignment="Stretch"
                               Margin="40 5" CanUserResizeColumns="False"
                               CanUserReorderColumns="False"
                               CanUserSortColumns="True"
                               IsReadOnly="True">
                <controls:DataGrid.ColumnHeaderStyle>
                    <Style TargetType="primitives:DataGridColumnHeader">
                        <Setter Property="FontSize" Value="15"/>
                    </Style>
                </controls:DataGrid.ColumnHeaderStyle>

                <controls:DataGrid.Columns>
                    <controls:DataGridTextColumn Header="Title" Width="40*" Binding="{Binding Title}"/>
                    <controls:DataGridTextColumn Header="Author" Width="30*" Binding="{Binding Author}"/>
                    <controls:DataGridTextColumn Header="Genre" Width="25*" Binding="{Binding Genre}"/>
                    <controls:DataGridTextColumn Header="Year Published" Width="15*" Binding="{Binding YearPublished}"/>
                    <controls:DataGridTextColumn Header="Quantity" Width="Auto" Binding="{Binding Quantity}"/>

                    <controls:DataGridTemplateColumn Width="15*">
                        <controls:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Visibility="Visible">
                                    <CommandBar  HorizontalAlignment="Right" DefaultLabelPosition="Right">
                                        <AppBarButton Icon="Edit" Label="Edit" Style="{StaticResource DefaultAppBarButtonStyle}"  
                                                      Click="EditButton_ClickAsync"
                                                      Tag="{Binding}"/>

                                        <AppBarButton Icon="Delete" Label="Delete" Style="{StaticResource DefaultAppBarButtonStyle}"
                                                      Command="{Binding DataContext.DeleteCommand, ElementName=BooksTable}"
                                                      Tag="{Binding}"/>

                                    </CommandBar>
                                </StackPanel>
                            </DataTemplate>
                        </controls:DataGridTemplateColumn.CellTemplate>
                    </controls:DataGridTemplateColumn>
                </controls:DataGrid.Columns>
            </controls:DataGrid>
        </StackPanel>
        <ContentDialog x:Name="EditBookDialog"   Title="Edit Book Details" 
                       PrimaryButtonText="Save" SecondaryButtonText="Cancel"
                       PrimaryButtonClick="EditDialogPrimaryButton_Clicked">
            <StackPanel Spacing="12">
                <TextBlock Text="Enter Book Title:"/>
                <TextBox x:Name="TitleBox" PlaceholderText="Name" Width="260"/>

                <TextBlock Text="Enter Author:"/>
                <TextBox x:Name="AuthorBox" PlaceholderText="Surname" Width="260"/>

                <TextBlock Text="Enter Genre:"/>
                <TextBox x:Name="GenreBox" PlaceholderText="Genre" Width="260"/>

                <TextBlock Text="Enter Year Published:"/>
                <TextBox x:Name="YearPublishedBox" PlaceholderText="Year Published" Width="260"/>

                <TextBlock Text="Enter Quantity:"/>
                <TextBox x:Name="QuantityBox" PlaceholderText="Quantity" Width="260"/>
            </StackPanel>
        </ContentDialog>
    </Grid>
</Page>
